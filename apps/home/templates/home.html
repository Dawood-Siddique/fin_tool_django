{% extends 'basic.html' %}
{% block extra_head %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}
{% block body%}
<div class="min-h-screen flex flex-col items-center">
    <div>
        <h1 class="text-lg font-bold">Home page</h1>
        <button id="chart-btn" class="text-lg flex border-2 rounded  px-2 border-amber-300 text-amber-300">Get Data</button>
    </div>
    <div>
        <pre id="chart"></pre>
    </div>
    <!-- <div class="flex flex-row"> -->
    <div>
        <button class="text-lg border-2 rounded  px-2 m-4 border-green-300 text-green-300">UP</button>
        <button class="text-lg border-2 rounded  px-2 m-4 border-gray-300 text-gray-300">SKIP</button>
        <button class="text-lg border-2 rounded  px-2 m-4 border-red-300 text-red-300">DOWN</button>
    </div>
</div>

<script>
    document.getElementById('chart-btn').addEventListener('click', function () {
        fetch('chart/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("Fetched data:", data);
                const trace = {
                    x: data.map(d => d.to),
                    open: data.map(d => d.open),
                    high: data.map(d => d.high),
                    low: data.map(d => d.low),
                    close: data.map(d => d.close),
                    type: 'candlestick',
                    xaxis: 'x',
                    yaxis: 'y'
                };

                const layout = {
                    title: 'Candlestick Chart',
                    dragmode: 'zoom',
                    xaxis: {
                        rangeslider: { visible: false },
                        type: 'date'
                    },
                    yaxis: {
                        autorange: true
                    }
                };

                Plotly.newPlot('chart', [trace], layout);
            })
            .catch(error => {
                console.error('Error fetching or plotting data:', error);
            });
    });
</script>

{% endblock %}