{% extends 'basic.html' %}
{% block extra_head %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}
{% block body%}
<h1>Home page</h1>
<button id="chart-btn">Get Data</button>
<pre id="chart"></pre>

<script>
    document.getElementById('chart-btn').addEventListener('click', function () {
        fetch('chart/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("Fetched data:", data);
                const trace = {
                    x: data.map(d => d.to),
                    open: data.map(d => d.open),
                    high: data.map(d => d.high),
                    low: data.map(d => d.low),
                    close: data.map(d => d.close),
                    type: 'candlestick',
                    xaxis: 'x',
                    yaxis: 'y'
                };

                const layout = {
                    title: 'Candlestick Chart',
                    dragmode: 'zoom',
                    xaxis: {
                        rangeslider: { visible: false },
                        type: 'date'
                    },
                    yaxis: {
                        autorange: true
                    }
                };

                Plotly.newPlot('chart', [trace], layout);
            })
            .catch(error => {
                console.error('Error fetching or plotting data:', error);
            });
    });
</script>

{% endblock %}